# PageRank

关键词：初始化、计算、终止点、陷阱、随机浏览、反作弊、缺陷

PageRank，网页排名，又称佩奇排名。谷歌的两位创始人，佩奇 (Larry Page) 和布林 (Sergey Brin) 开始了对网页排序问题的研究。他们的借鉴了学术界评判学术论文重要性的通用方法， 那就是看论文的引用次数。由此想到网页的重要性也可以根据这种方法来评价。于是PageRank的核心思想就诞生了，非常简单：

> - 如果一个网页被很多其他网页链接到的话说明这个网页比较重要，也就是PageRank值会相对较高；
> - 如果一个PageRank值很高的网页链接到一个其他的网页，那么被链接到的网页的PageRank值会相应地因此而提高；

PageRank 算法计算每一个网页的 PageRank 值，然后根据这个值的大小对网页的重要性进行排序。它的思想是模拟一个悠闲的上网者，上网者首先随机选择一个网页打开，然后在这个网页上呆了几分钟，跳转到该网页所指向的链接，这样无所事事、漫无目的地在网页上跳来跳去，PageRank 就是估计这个悠闲的上网者分布在各个网页上的概率。

PageRank 背后的两个基本假设：

数量假设：更重要的网页可能被更多的网页链接到。
质量假设：有更高的 PageRank 的网页将会传递更高的权重

# PageRank模型

我们可以将 Web 作如下抽象：

将每个网页抽象成一个节点；
如果一个页面 A 有链接直接链向 B，则存在一条有向边从 A 到 B。
因此，整个 Web 被抽象为一张有向图。

![Web抽象](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMi5heDF4LmNvbS8yMDE5LzA0LzI4L0VRbXJSTy5qcGc?x-oss-process=image/format,png)

此时，我们需要用一种合适的数据结构来表示页面以及页面间的连接关系。假设当一个用户停留在某页面时，跳转到它所链接的所有页面的概率是相同的。例如，上图中 A 页面链向 B、C、D，所以用户从 A 页面跳转到 B、C、D 的概率各为 1/3。设一共有 N 个网页，则可以组织这样一个 N 维矩阵：其中 i 行 j 列的值表示用户从页面 j 跳转到页面 i 的概率。这样的一个矩阵叫做转移矩阵（Transition Matrix）。
$$
M =\left[ \begin{matrix} A \to A & B \to A & C \to A & D \to A \\ 
B \to A  & B \to B & C \to B & D \to B  \\ 
A \to C & B \to C & C \to C & D \to C \\ 
A \to D & B \to D & C \to D & D \to D 
\end{matrix} \right]
$$
以及：
$$
M =\left[ \begin{matrix} 0 & \frac{1}{2} & 0 &  \frac{1}{2} \\ 
 \frac{1}{3}  & 0 & 0 &  \frac{1}{2}  \\ 
 \frac{1}{3}& \frac{1}{2} & 0 &0 \\ 
 \frac{1}{3} & 0 & 1 & 0 
\end{matrix} \right]
$$



观察转移矩阵可以发现：

矩阵的每一列代表一个具体网页的出链，简单地说就是当前网页向其他网页的链接；
矩阵的每一行代表一个具体网页的入链，简单地说就是其他网页向当前网页的链接

## PageRank 初始化

PageRank 值的物理意义是一个网页被访问的概率，**初始时用户访问每个页面的概率均等**，假设一共有 N 个网页，每个网页的初始 PR 值 = $1 / N$。我们可以将这些网页的初始 PR 值保存到一个向量中。

继续沿用先前的图，初始 PR 值向量
$$
P_0=(PR_A,PR_B,PR_C,PR_D)^T=(\frac{1}{4},\frac{1}{4},\frac{1}{4},\frac{1}{4})
$$

## PageRank 计算

继续使用先前的例子，由 A、B、C、D 四个页面组成的 Web。


![Web抽象](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMi5heDF4LmNvbS8yMDE5LzA0LzI4L0VRbXJSTy5qcGc?x-oss-process=image/format,png)

对于页面 A 来说，有 B、D 页面链向它，那么 A 的 PR 值（PageRank 值）将是 B、D 页面 PR 值之和。
$$
PR(A)=PR(B)+PR(D)
$$
由于页面 B 也有链接到页面 C，一个页面不能投票 2 次，所以 B 给每个页面半票。同样的，D 投出的票也只有 1/2 算到了 A 的 PageRank 上。
$$
PR(A)=\frac{PR(B)}{2}+\frac{PR(D)}{2}
$$
换句话说，根据链出总数平分一个页面的 PR 值，令 L(X) 表示 X 页面的链出总数，那么 A 的 PageRank 值计算公式可写成如下统一形式。
$$
PR(A)=\frac{PR(B)}{L}+\frac{PR(D)}{L}
$$
我们再把上面的公式简化一下，将其推广到更大的范围。
$$
PR_i = \sum_{j\in B_i}\frac{PR_j}{L_j}
$$
其中$PR_i$表示网页 i 的 pagerank 值，$PR_j$ 表示网页 j 的 pagerank 值，$L_j$ 表示网页 j 链出的链接数，$B_i$ 表示链接到网页i的网页集合

由于我们计算的是概率值，且初始每个页面的概率都相等，因此我们可求出在经过上述出链和入链后，各个页面的停留概率。

## 终止点问题

先前所举的例子是一个理想状态：假设所有网页组成的有向图是强连通的，即从一个网页可以到达任意网页。但实际的网络链接环境没有这么理想，有一些网页不指向任何网页，或不存在指向自己的链接。

![终止点问题](https://img-blog.csdnimg.cn/20200318195036812.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzM3ODM5Ng==,size_16,color_FFFFFF,t_70)

【终止点】：一个没有任何出链的网页，例如上图的 C 点。上网者浏览到 C 网页将终止于该网页，而无法继续浏览其他网页。

根据上图我们可以写出转移矩阵 M：
$$
M =\left[ \begin{matrix} 0 & \frac{1}{2} & 0 &  0 \\ 
 \frac{1}{3}  & 0 & 0 &  \frac{1}{2}  \\ 
 \frac{1}{3}& 0 & 0 &\frac{1}{2}\\ 
 \frac{1}{3} & \frac{1}{2} & 0 & 0 
\end{matrix} \right]
$$
可以看到，经过多次跳转之后，所有网页的 PR 值都是 0，这样的计算结果是无意义的。

【解决方案】：当访问到终止点 C 而“走投无路”时，以等概率随机跳转到下一个网页，从而开启一次新的访问。

改造终止点 C，使它能够等概率地游走到网络中的所有页面，即添加从 C 到包括它本身的所有页面的链接。
在上例中就是将转移矩阵 M 的第三列的每一项改为 1/4。这样改造后，每一个节点都有出链，相应的 M 的每一列的列累加和都为 1。

## 陷阱问题

陷阱指的是只有指向自身链接的网页。

![陷阱问题示例图.png](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMi5heDF4LmNvbS8yMDE5LzA1LzE4L0VYUGcxSS5wbmc?x-oss-process=image/format,png)

上网者浏览到 C 网页将陷入无休止的循环之中，根据上图我们可以写出转移矩阵 M：


$$
M =\left[ \begin{matrix} 0 & \frac{1}{2} & 0 &  0 \\ 
 \frac{1}{3}  & 0 & 0 &  \frac{1}{2}  \\ 
 \frac{1}{3}& 0 & 1 &\frac{1}{2}\\ 
 \frac{1}{3} & \frac{1}{2} & 0 & 0 
\end{matrix} \right]
$$
可以看到经过多次跳转，跳转到陷阱页面的概率值为 1，而跳转到其他正常网页的概率值为 0，这样的计算结果也是无意义的。

当用户遇到终止点或者陷阱的话，他不会不知所措，也不会无休止地自己打转，他会通过浏览器的地址栏输入新的地址，以逃离这个网页。也就是说，用户以一个网页跳转至另一个网页的过程中，会以一定概率不点击当前网页的链接，而是在地址栏中输入一个新的地址。

【解决方案】：随机浏览模型。

## 随机浏览模型

假定一个上网者从一个随机的网页开始浏览，此时有两种选择：

通过点击当前页面的其他链接开始下一次浏览；
通过在浏览器的地址栏输入新的地址以开启一个新的网页。
其中，上网者通过点击链接开启新页面的概率为 d（d 也称阻尼系数，通常取 0.85）。

此时，我们的 PageRank 模型变为：在每一个页面，用户都有 d 的概率通过点击链接进入下一个页面；此外，还有 1 - d 的概率随机跳转，此时跳转到其他页面的概率为 1 / N（当前页面的其他链接数）。

【随机浏览模型公式】：
$$
PR_i = d\sum_{j \in B_i}\frac{PR_i}{L_j}+ \frac{1-d}{N}
$$
【概率转移公式】：
$$
P_n = dM \cdot P_{n-1}+ (1-d)P_0 \\
P_n = AP_{n-1} \\
A = dM + (1-d)e e^T/N
$$
先使用概率转移公式计算跳转到每个页面的概率值。由于存在一定的概率跳出循环，因此可以避免陷阱问题。

## 随机浏览模型的收敛性

PageRank 模型的前提：假设用户选择浏览的下一个网页与过去浏览过哪些网页无关，而仅依赖于当前所在的页面，则该过程可以认为是一个有限状态、离散时间的随机过程。

这种“将来”的情况与“过去”无关，而只与“当前”状态有关的性质称为马尔可夫性。具有马尔可夫性的随机过程称为马尔可夫过程。时间和状态都是离散的马尔可夫过程称为马尔可夫链：$P_0,P_1,P_2,...,P_n$是一个马尔可夫链。

对于马尔可夫链$P_n = AP_{n-1}$当概率转移矩阵A满足一下三个条件时，$P_n$最终收敛，保持在一个稳定值附近。

A 为随机矩阵：即所有 A[i][j]>= 0，且 A 的所有列向量的元素和为 1；
A 是不可约的：A 是不可约的当且仅当 A 所对应的图是强连通的。
A 是非周期的：对某个不等于 1 的自然数 K，如果 $A^k=E$则称 A 为周期矩阵，K 是矩阵 A 的周期。而 A 的每个元素都是正数，所以无论 A 与自身相乘多少次所得到的矩阵，其元素都不可能出现 0，自然也不可能为 E，所以 A 是非周期的。

## Link Spam 与反作弊

首先介绍两个新的概念——链接农场和黄金链。

链接农场：是指由互联网中的一部分网页组成，这些网页非常密集地互相连接在一起。通过创建一个堆砌大量链接而没有实质内容的网页，这些链接彼此互链，或指向特定网站，以提高某个或者某些特定网页的 PageRank 值。
黄金链：指一些高权重的网站出售首页的链接给作弊网站，以提高作弊网站的 PageRank 值。
链接作弊者眼中的 Web 组成结构：

不可达网页：作弊者无法影响的网页。Web 中的大部分网页都属于这一类。
可达网页：虽然不受作弊者控制，但作弊者可以影响它们。
自有网页：作弊者拥有并完全控制的网页。

![作弊者眼中的Web组成结构.png](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMi5heDF4LmNvbS8yMDE5LzA1LzE5L0VYZndmcy5wbmc?x-oss-process=image/format,png)

假设目标网页 T 的总 PageRank 值为 y，则 y 由三部分组成：

- 可达网页的贡献，设为 x；
- Web 中所有网页平均分到的贡献：(1 - β)/n，这部分值很小，可以忽略。
- 自有网页的贡献：设有 m 个自有网页，每个自有网页的 PageRank 值为$\beta y/m + (1-\beta)/n$

$$

$$

# PageRank 算法缺点

- 主题漂移问题

  PageRank 算法仅利用网络的链接结构，无法判断网页内容上的相似性；且算法根据向外链接平均分配权值使得主题不相关的网页获得与主题相关的网页同样的重视度，出现主题漂移。

- 没有过滤广告链接和功能链接

  例如常见的“分享到微博”，这些链接通常没有什么实际价值，前者链接到广告页面，后者常常链接到某个社交网站首页。

- 对新网页不友好

  一个新网页的入链相对较少，即便它的内容质量很高，但要成为一个高 PR 值的页面仍需要很长时间的推广。

















